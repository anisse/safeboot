


<!doctype html>
<html lang="en" class="no-js">
  <head>
    

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.0">
    
<meta property="og:title" content="Safeboot: Boot Linux more safely">
<meta property="og:description" content="Debian package to enable UEFI SecureBoot, enroll your own hardware backed platform key, sign the kernel and initrd, decrypt the disk with the TPM, and enable system integrity protection with dmverity">
<meta property="og:url" content="https://safeboot.dev/">
<meta property="og:image" content="https://safeboot.dev/images/installation-header.jpg">

    
      
        <title>`/usr/sbin/safeboot` subcommands - safeboot</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.89dc9fe3.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecd4686e.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="purple">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#usrsbinsafeboot-subcommands" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="safeboot" class="md-header-nav__button md-logo" aria-label="safeboot">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            safeboot
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              `/usr/sbin/safeboot` subcommands
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/osresearch/safeboot/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="safeboot" class="md-nav__button md-logo" aria-label="safeboot">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    safeboot
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/osresearch/safeboot/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-init-subject" class="md-nav__link">
    key-init subject
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yubikey-init-subject" class="md-nav__link">
    yubikey-init subject
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uefi-sign-keys" class="md-nav__link">
    uefi-sign-keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uefi-set-keys" class="md-nav__link">
    uefi-set-keys
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luks-seal-0257-14" class="md-nav__link">
    luks-seal [0,2,5,7... 14]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sign-kernel-boot-name-parameters" class="md-nav__link">
    sign-kernel 'boot-name' parameters...
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-sign-target-parameters" class="md-nav__link">
    linux-sign [target [parameters...]]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recovery-sign-kernel-command-line" class="md-nav__link">
    recovery-sign [kernel command line...]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recovery-reboot" class="md-nav__link">
    recovery-reboot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remount" class="md-nav__link">
    remount
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sip-init-home-size-var-size" class="md-nav__link">
    sip-init home-size [var-size]
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="usrsbinsafeboot-subcommands"><code>/usr/sbin/safeboot</code> subcommands</h1>
<h2 id="key-init-subject">key-init subject</h2>
<p>Generate a new x509 signing key with openssl.
  The subject must be written as:
       /CN=host.example.com/OU=test/O=example.com/</p>
<h2 id="yubikey-init-subject">yubikey-init subject</h2>
<p>Generate a new x509 signing key on an attached Yubikey device
  and set the certificate subject to the provided argument.</p>
<p>The subject must be written as:
       /CN=host.example.com/OU=test/O=example.com/</p>
<h2 id="uefi-sign-keys">uefi-sign-keys</h2>
<p>Create three signed certificates for the PK, KEK, and db using
  the attached Yubikey and store them in the UEFI SecureBoot configuration.
  You will have to authenticate to the yubikey multiple times during this process.</p>
<h2 id="uefi-set-keys">uefi-set-keys</h2>
<p>Store the PK, KEK, and db into the UEFI Secure Boot configuration
  variables.  This must be done once during system setup.</p>
<h2 id="luks-seal-0257-14">luks-seal [0,2,5,7... 14]</h2>
<p>Generate a new LUKS encryption key for the block devices in /etc/crypttab,
  sealed with the optional comma separated list of TPM PCRs.  PCR 14 will be
  used to indicate a 'postboot' status to prevent the key from being unsealed
  after the initramfs has run.</p>
<p>If this is the first time the disk has been sealed, /etc/crypttab
  will be updated to include a call to the unsealing script to retrieve
  the keys from the TPM.  You will have to run 'sudo update-initramfs -u'
  to rebuild the initrd.</p>
<p>Right now only a single crypt disk is supported.</p>
<h2 id="sign-kernel-boot-name-parameters">sign-kernel 'boot-name' parameters...</h2>
<p>Create an EFI boot menu entry for 'boot-name', with the specified
  kernel, initrd and command line bundled into an executable and signed.
  This is the raw command; you might want to use hash-and-sign or
  recovery-sign instead.</p>
<h2 id="linux-sign-target-parameters">linux-sign [target [parameters...]]</h2>
<p>Generate dm-verity hashes and then sign the Linux with the root hash added
  to the kernel command line.</p>
<p>If HASH is set in the environment, it will be used instead of recomputing
  the dmverity hashes (which can take some time).</p>
<h2 id="recovery-sign-kernel-command-line">recovery-sign [kernel command line...]</h2>
<p>Sign the Linux kernel and initrd into the recovery target.
  If SIP is enabled the root device will be marked read-only and
  not-fsck'ed.  Use 'safeboot remount' to remount it read-write
  when in recovery mode.</p>
<h2 id="recovery-reboot">recovery-reboot</h2>
<p>Configure the next boot for a recovery and reboot the machine.</p>
<h2 id="remount">remount</h2>
<p>Attempt to remount the root filesystem read/write.
  If SIP is enabled this will likely invalidate any hashes
  and require a re-signing of the root filesystem.</p>
<h2 id="sip-init-home-size-var-size">sip-init home-size [var-size]</h2>
<p>DANGER! This command can mess up your root filesystem.
  There must be space in the volume group for the new entries
  Create the volume groups for /var and /home,
  adds entries to /etc/fstab for them, and makes /tmp a symlink
  into /var/tmp.</p>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: May 11, 2020
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.36cbf620.min.js"></script>
      <script src="../assets/javascripts/bundle.00c583dd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>